-- Held_Inventar und Held_Munition an die Trageort-Tabelle angehängt, Härtbarkeit hinzugefügt, Rüstungen Steif-Eigenschaft
ALTER TABLE MUNITION ADD [Härtbar] bit NOT NULL DEFAULT 0
GO

UPDATE Munition SET Härtbar = 1 Where Spitze in ('Klingenspitze','Kettenstecher-Spitze','Widerhaken-Spitze','Plattenstecher-Spitze','Mondsichel-Spitze')
GO

DROP TABLE Held_Munition
GO


CREATE TABLE [Held_Munition] (
	[HeldGUID] uniqueidentifier NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000', 
	[FernkampfwaffeGUID] uniqueidentifier NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000', 
	[MunitionGUID] uniqueidentifier NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000', 
	[TrageortGUID] uniqueidentifier NOT NULL DEFAULT '00000000-0000-0000-001A-000000000011',
	[Gehärtet] bit NOT NULL default 0,
	[Anzahl] int,
	CONSTRAINT [PK_Held_Munition] PRIMARY KEY ([HeldGUID], [FernkampfwaffeGUID], [MunitionGUID], [TrageortGUID], [Gehärtet]), 
	CONSTRAINT fk_HeldMunition_Fernkampfwaffe FOREIGN KEY ([FernkampfwaffeGUID])
		REFERENCES Fernkampfwaffe ([FernkampfwaffeGUID])
		ON UPDATE CASCADE ON DELETE CASCADE, 
	CONSTRAINT fk_HeldMunition_Held FOREIGN KEY ([HeldGUID])
		REFERENCES Held ([HeldGUID])
		ON UPDATE CASCADE ON DELETE CASCADE, 
	CONSTRAINT fk_HeldMunition_Munition FOREIGN KEY ([MunitionGUID])
		REFERENCES Munition ([MunitionGUID])
		ON UPDATE CASCADE ON DELETE CASCADE,
	CONSTRAINT fk_HeldMunition_TrageortGUID FOREIGN KEY ([TrageortGUID])
		REFERENCES Trageort ([TrageortGUID])
		ON UPDATE CASCADE ON DELETE CASCADE
)
GO

Alter Table Rüstung ADD [Steif] bit not null default 0
GO
UPDATE Rüstung SET Steif=1 where RüstungGUID in ('00000000-0000-0000-0004-000000000014','00000000-0000-0000-0004-000000000020','00000000-0000-0000-0004-000000000022','00000000-0000-0000-0004-000000000024','00000000-0000-0000-0004-000000000026','00000000-0000-0000-0004-000000000028','00000000-0000-0000-0004-000000000025','00000000-0000-0000-0004-000000000041','00000000-0000-0000-0004-000000000042','00000000-0000-0000-0004-000000000043','00000000-0000-0000-0004-000000000049','00000000-0000-0000-0004-000000000051','00000000-0000-0000-0004-000000000052','00000000-0000-0000-0004-000000000064','00000000-0000-0000-0004-000000000065','00000000-0000-0000-0004-000000000046','00000000-0000-0000-0004-000000000004','00000000-0000-0000-0004-000000000009','00000000-0000-0000-0004-000000000003','00000000-0000-0000-0004-000000000005','00000000-0000-0000-0004-000000000008','00000000-0000-0000-0004-000000000010','00000000-0000-0000-0004-000000000060','00000000-0000-0000-0004-000000000055','00000000-0000-0000-0004-000000000056','00000000-0000-0000-0004-000000000057','00000000-0000-0000-0004-000000000058','00000000-0000-0000-0004-000000000059')
GO
Alter Table Rüstung DROP COLUMN gRS
GO
Alter Table Rüstung DROP COLUMN gBE
GO

DROP TABLE Held_Inventar
GO

CREATE TABLE [Held_Inventar] (
	[HeldGUID] uniqueidentifier NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000', 
	[Angelegt] bit NOT NULL DEFAULT 0, 
	[TrageortGUID] uniqueidentifier NOT NULL DEFAULT '00000000-0000-0000-001A-000000000011',
	[InventarGUID] uniqueidentifier NOT NULL DEFAULT '00000000-0000-0000-0000-000000000000', 
	[Anzahl] int,	CONSTRAINT [PK_Held_Inventar] PRIMARY KEY ([HeldGUID], [TrageortGUID], [InventarGUID]), 
	CONSTRAINT fk_HeldInventar_Held FOREIGN KEY ([HeldGUID])
		REFERENCES Held ([HeldGUID])
		ON UPDATE CASCADE ON DELETE CASCADE, 
	CONSTRAINT fk_HeldInventar_Inventar FOREIGN KEY ([InventarGUID])
		REFERENCES Inventar ([InventarGUID])
		ON UPDATE CASCADE ON DELETE CASCADE,
	CONSTRAINT fk_HeldInventar_TrageortGUID FOREIGN KEY ([TrageortGUID])
		REFERENCES Trageort ([TrageortGUID])
		ON UPDATE CASCADE ON DELETE CASCADE
)
GO