<UserControl
    x:Class="MeisterGeister.View.Bodenplan.BattlegroundView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ViewGeneral="clr-namespace:MeisterGeister.View.General"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:kampflogic="clr-namespace:MeisterGeister.ViewModel.Kampf.Logic"
    xmlns:local="clr-namespace:MeisterGeister.View.Bodenplan"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:model="clr-namespace:MeisterGeister.ViewModel.Bodenplan.Logic"
    xmlns:s="clr-namespace:MeisterGeister.View.Bodenplan"
    xmlns:wpfxc="clr-namespace:WPFExtensions.Controls;assembly=WPFExtensions"
    xmlns:xctk="clr-namespace:Xceed.Wpf.Toolkit;assembly=Xceed.Wpf.Toolkit"
    x:Name="view"
    d:DesignHeight="1100"
    d:DesignWidth="1280"
    Unloaded="View_Unloaded"
    mc:Ignorable="d">
    <UserControl.Resources>
        <ViewGeneral:EnumItemsSource x:Key="PositionenValues" Type="{x:Type kampflogic:Position}" />
        <SolidColorBrush x:Key="ListBox.Static.Background" Color="#FFFFFFFF" />
        <SolidColorBrush x:Key="ListBox.Static.Border" Color="#FFABADB3" />
        <SolidColorBrush x:Key="ListBox.Disabled.Background" Color="#FFFFFFFF" />
        <SolidColorBrush x:Key="ListBox.Disabled.Border" Color="#FFD9D9D9" />
        <ViewGeneral:ColorToSolidBrushValueConverter x:Key="ColorConverter" />
        <ViewGeneral:IsNullOrEmptyConverter x:Key="IsNullOrEmptyConverter" />
        <kampflogic:IsIntToBoolConverter x:Key="IsIntToBoolConverter1" />
        <ViewGeneral:IsEqualOrGreaterThanConverter x:Key="IsEqualOrGreaterThanConverter1" />
        <ViewGeneral:IsEqualOrGreaterThanVisibleConverter x:Key="IsEqualOrGreaterThanVisibleConverter1" />
        <ViewGeneral:MerkmalListeAnzahlToVisibleConverter x:Key="MerkmalListeAnzahlToVisibleConverter1" />
        <ViewGeneral:MerkmaleListeToBrushColor x:Key="MerkmaleListeToBrushColor1" />
        <model:PositionToImageConverter x:Key="PositionToImageConverter1" />
        <BitmapImage x:Key="FragezeichenBild" UriSource="/DSA MeisterGeister;component/Images/Icons/General/fragezeichen.png" />

        <Style TargetType="ProgressBar">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ProgressBar">
                        <Grid x:Name="Root">
                            <Border
                                Name="PART_Track"
                                Background="LightGray"
                                BorderBrush="Gray"
                                BorderThickness="1"
                                CornerRadius="2" />
                            <Border
                                Name="PART_Indicator"
                                HorizontalAlignment="Left"
                                Background="#FF1FF31F"
                                BorderBrush="Gray"
                                BorderThickness="1"
                                CornerRadius="1" />
                        </Grid>
                        <ControlTemplate.Triggers>
                            <!--  Getting vertical style working using technique described here: http://stackoverflow.com/a/6849237/7532  -->
                            <Trigger Property="Orientation" Value="Vertical">
                                <Setter TargetName="Root" Property="LayoutTransform">
                                    <Setter.Value>
                                        <RotateTransform Angle="270" />
                                    </Setter.Value>
                                </Setter>
                                <Setter TargetName="Root" Property="Width" Value="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=Height}" />
                                <Setter TargetName="Root" Property="Height" Value="{Binding RelativeSource={RelativeSource TemplatedParent}, Path=Width}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>
    <UserControl.InputBindings>
        <KeyBinding Key="Delete" Command="{Binding DeleteCommand}" />
    </UserControl.InputBindings>
    <Grid>
        <Grid.Resources>
            <ViewGeneral:ColorToSolidBrushValueConverter x:Key="ColorToBrushConverter" />
            <kampflogic:DataTypeConverter x:Key="DataTypeConverter1" />
            <BooleanToVisibilityConverter x:Key="BoolToVisibilityConverter" />
            <ViewGeneral:ImagePathConverter x:Key="ImagePathConverter" />
            <ViewGeneral:EnumItemsSource x:Key="ZeichenValues" Type="{x:Type model:ZeichenModus}" />
        </Grid.Resources>
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="{Binding MeisterBGWidth, UpdateSourceTrigger=PropertyChanged}" />
            </Grid.ColumnDefinitions>
            <Expander
                Grid.Column="0"
                Margin="0,24,0,0"
                HorizontalAlignment="Left"
                ExpandDirection="Right"
                IsExpanded="False">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Expander Grid.Column="0" IsExpanded="True">
                        <ScrollViewer
                            VerticalAlignment="Top"
                            HorizontalScrollBarVisibility="Auto"
                            VerticalScrollBarVisibility="Auto">
                            <StackPanel Orientation="Horizontal">
                                <Grid
                                    x:Name="grid1"
                                    Width="200"
                                    Margin="12,0,0,0"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Top"
                                    ClipToBounds="True"
                                    IsManipulationEnabled="False">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="24" />
                                        <RowDefinition Height="225" />
                                        <RowDefinition Height="87" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="24*" />
                                        <ColumnDefinition Width="160" />
                                        <ColumnDefinition Width="24*" />
                                    </Grid.ColumnDefinitions>
                                    <CheckBox
                                        x:Name="checkBox3"
                                        Grid.Column="1"
                                        Width="113"
                                        Height="20"
                                        Margin="25,5,0,0"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Top"
                                        Content="Editor Modus"
                                        FontSize="14"
                                        FontStyle="Normal"
                                        FontWeight="SemiBold"
                                        IsChecked="{Binding IsEditorModeEnabled}"
                                        ToolTip="Wenn deaktiviert, können nur noch Helden und Monster bewegt werden" />
                                    <StackPanel
                                        Grid.Row="1"
                                        Grid.Column="1"
                                        HorizontalAlignment="Left">
                                        <s:SliderWithDisplayTextBox
                                            x:Name="sliderWithDisplayTextBox_AlphaChannel"
                                            Width="160"
                                            SliderLabelTextValue="Alpha Kanal"
                                            SliderMaxTextValue="1"
                                            SliderMaxValue="1"
                                            SliderMinTextValue="0"
                                            SliderMinValue="0"
                                            SliderValue="{Binding SelectedFillColorAlpha, Mode=TwoWay}"
                                            TickFrequencyValue="0.1" />
                                        <s:SliderWithDisplayTextBox
                                            x:Name="sliderWithDisplayTextBox_StrokeThickness"
                                            Width="160"
                                            SliderLabelTextValue="Linien Stärke"
                                            SliderMaxTextValue="30"
                                            SliderMaxValue="30"
                                            SliderMinTextValue="1"
                                            SliderMinValue="1"
                                            SliderValue="{Binding StrokeThickness, Mode=TwoWay}"
                                            TickFrequencyValue="1" />
                                        <s:SliderWithDisplayTextBox
                                            x:Name="sliderWithDisplayTextBox_Opacity"
                                            Width="160"
                                            SliderLabelTextValue="Transparenz"
                                            SliderMaxTextValue="100%"
                                            SliderMaxValue="1"
                                            SliderMinTextValue="10%"
                                            SliderMinValue="0.1"
                                            SliderValue="{Binding Opacity, Mode=TwoWay}"
                                            TickFrequencyValue="0.1" />
                                        <s:SliderWithDisplayTextBox
                                            x:Name="sliderWithDisplayTextBox_ObjectSize"
                                            Width="160"
                                            SliderLabelTextValue="Objektgröße"
                                            SliderMaxTextValue="20x"
                                            SliderMaxValue="20"
                                            SliderMinTextValue="0.3x"
                                            SliderMinValue="0.3"
                                            SliderValue="{Binding ObjectSize, Mode=TwoWay}"
                                            TickFrequencyValue="0.1" />

                                        <s:SliderWithDisplayTextBox
                                            x:Name="sliderWithDisplayTextBox_ZLevel"
                                            Grid.Row="2"
                                            Grid.Column="1"
                                            Width="160"
                                            Margin="0,10,0,0"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Top"
                                            SliderLabelTextValue="Z-Level"
                                            SliderMaxTextValue="20"
                                            SliderMaxValue="20"
                                            SliderMinTextValue="0"
                                            SliderMinValue="0"
                                            SliderValue="{Binding ZLevel, Mode=TwoWay}"
                                            TickFrequencyValue="1" />
                                        <CheckBox
                                            x:Name="checkBox1"
                                            Grid.Row="2"
                                            Grid.Column="1"
                                            Width="113"
                                            Height="18"
                                            VerticalAlignment="Top"
                                            Content="Z-Level Anzeigen"
                                            IsChecked="{Binding ShowZ}" />
                                    </StackPanel>

                                    <ToggleButton
                                        x:Name="PathLineButton"
                                        Grid.Row="2"
                                        Grid.Column="1"
                                        Width="77"
                                        Height="25"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Top"
                                        Content="[1] Line"
                                        IsChecked="{Binding CreateLine, Mode=OneWay}" />
                                    <ToggleButton
                                        x:Name="FilledPathLineButton"
                                        Grid.Row="2"
                                        Grid.Column="1"
                                        Width="77"
                                        Height="25"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Top"
                                        Content="[2] Fläche"
                                        IsChecked="{Binding CreateFilledLine, Mode=OneWay}" />

                                    <Button
                                        x:Name="ButtonEbeneHigher"
                                        Grid.Row="2"
                                        Grid.Column="1"
                                        Width="77"
                                        Height="23"
                                        Margin="0,27,0,0"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Top"
                                        Click="ButtonEbeneHigher_Click"
                                        Content="Ebene +" />
                                    <Button
                                        x:Name="ButtonEbeneLower"
                                        Grid.Row="2"
                                        Grid.Column="1"
                                        Width="77"
                                        Height="23"
                                        Margin="83,27,0,0"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Top"
                                        Click="ButtonEbeneLower_Click"
                                        Content="Ebene -" />
                                    <Button
                                        x:Name="ButtonEbeneHigherMax"
                                        Grid.Row="2"
                                        Grid.Column="1"
                                        Width="77"
                                        Height="23"
                                        Margin="0,53,0,0"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Top"
                                        Click="ButtonEbeneHigherMax_Click"
                                        Content="Ebene max" />
                                    <Button
                                        x:Name="ButtonEbeneLowerMin"
                                        Grid.Row="2"
                                        Grid.Column="1"
                                        Width="77"
                                        Height="23"
                                        Margin="82,53,0,0"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Top"
                                        Click="ButtonEbeneLowerMin_Click"
                                        Content="Ebene min" />
                                </Grid>
                                <StackPanel Orientation="Vertical">
                                    <!--  Zeichenmodi  -->
                                    <ListBox SelectedValue="{Binding ZeichenModus}">
                                        <ListBox.Resources>
                                            <ViewGeneral:DictionaryValueConverter x:Key="toolImages">
                                                <ViewGeneral:DictionaryValueConverter.Values>
                                                    <BitmapImage x:Key="Auswahl" UriSource="/DSA MeisterGeister;component/Images/Icons/Zeichnen/auswahlpfeil.png" />
                                                    <BitmapImage x:Key="Linie" UriSource="/DSA MeisterGeister;component/Images/Icons/Zeichnen/linie.png" />
                                                    <BitmapImage x:Key="Fläche" UriSource="/DSA MeisterGeister;component/Images/Icons/Zeichnen/polygon.png" />
                                                    <BitmapImage x:Key="None" UriSource="/DSA MeisterGeister;component/Images/Icons/General/fragezeichen.png" />
                                                </ViewGeneral:DictionaryValueConverter.Values>
                                            </ViewGeneral:DictionaryValueConverter>
                                        </ListBox.Resources>
                                        <ListBox.ItemsSource>
                                            <StaticResource ResourceKey="ZeichenValues" />
                                        </ListBox.ItemsSource>
                                        <ListBox.ItemTemplate>
                                            <DataTemplate>
                                                <Image
                                                    Width="30"
                                                    Height="30"
                                                    Source="{Binding Converter={StaticResource toolImages}}"
                                                    ToolTip="{Binding FallbackValue=None}" />
                                            </DataTemplate>
                                        </ListBox.ItemTemplate>
                                    </ListBox>
                                    <StackPanel
                                        Grid.Row="1"
                                        Grid.Column="1"
                                        Orientation="Horizontal">
                                        <Grid
                                            Grid.Row="1"
                                            Grid.Column="1"
                                            HorizontalAlignment="Left">
                                            <xctk:ColorPicker
                                                x:Name="colorPicker1"
                                                Width="22"
                                                Height="22"
                                                VerticalAlignment="Top"
                                                SelectedColor="{Binding SelectedColor}"
                                                ShowDropDownButton="False"
                                                ToolTip="Linienfarbe" />
                                            <Polygon
                                                Fill="White"
                                                IsHitTestVisible="False"
                                                Points="1,19.5 1,1 20.5,1" />
                                            <Polygon
                                                Fill="White"
                                                IsHitTestVisible="False"
                                                Points="2.5,21 22,21 22,2.5" />
                                        </Grid>
                                        <xctk:ColorPicker
                                            x:Name="colorPicker2"
                                            Width="22"
                                            Height="22"
                                            HorizontalAlignment="Left"
                                            VerticalAlignment="Top"
                                            SelectedColor="{Binding SelectedFillColor}"
                                            ShowDropDownButton="False"
                                            ToolTip="Füllfarbe" />
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                        </ScrollViewer>
                    </Expander>

                    <Expander Grid.Row="1" IsExpanded="True">
                        <Grid
                            Width="200"
                            Margin="12,0,0,0"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Top"
                            ClipToBounds="True"
                            IsManipulationEnabled="False">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="30" />
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <Button
                                x:Name="ButtonBildhinzu"
                                Width="77"
                                Height="23"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Top"
                                Click="ButtonBildhinzun_Click"
                                Content="Bild hinzu" />

                            <ListBox
                                x:Name="lstbxPictureButton"
                                Grid.Row="1"
                                Grid.ColumnSpan="2"
                                Width="165"
                                MinHeight="200"
                                Margin="0,0,3,0"
                                VerticalAlignment="Top"
                                ScrollViewer.VerticalScrollBarVisibility="Auto" />
                        </Grid>
                    </Expander>
                </Grid>
            </Expander>

            <Grid
                x:Name="grdSpielfeld"
                Grid.Column="1"
                Margin="0,24,0,0">
                <wpfxc:ZoomControl
                    x:Name="ArenaScrollViewer"
                    Grid.Column="1"
                    VerticalAlignment="Bottom"
                    Background="#FF367536"
                    LimitToContent="True"
                    MaxZoom="2"
                    MaxZoomDelta="2"
                    MinZoom="0.05"
                    Mode="Original"
                    ModifierKeyPan="Shift"
                    ModifierKeyZoom="Control"
                    ModifierKeyZoomBox="Alt"
                    PanWithoutModifier="True"
                    TranslateX="{Binding MeisterZoomTransX, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    TranslateY="{Binding MeisterZoomTransY, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    WheelZoomsAlone="True"
                    Zoom="{Binding MeisterZoom, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    ZoomDeltaMultiplier="50">
                    <Grid x:Name="ArenaGridTop">
                        <Image
                            x:Name="imgbtnBGStoppen"
                            Width="{Binding BackgroundOffsetSize, UpdateSourceTrigger=PropertyChanged}"
                            Margin="{Binding OffsetBackgroudMargin, UpdateSourceTrigger=PropertyChanged}"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Top"
                            Source="{Binding BackgroundImage}" />
                        <Image
                            x:Name="imgFog"
                            Width="10000"
                            Height="10000"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Top"
                            Opacity="0.5"
                            Source="{Binding FogImage}"
                            Visibility="{Binding useFog, Converter={StaticResource BooleanToVisibilityConverter1}, UpdateSourceTrigger=PropertyChanged}" />
                        <!--  ObjektListe.View  -->
                        <ListBox
                            x:Name="ArenaGrid"
                            Width="10000"
                            Height="10000"
                            AllowDrop="True"
                            DragOver="ArenaGrid_DragOver"
                            Drop="ArenaGrid_Drop"
                            GiveFeedback="ArenaGrid_GiveFeedback"
                            ItemsSource="{Binding BattlegroundObjects}"
                            MouseLeftButtonDown="ArenaGrid_MouseLeftButtonDown"
                            MouseLeftButtonUp="ArenaGrid_MouseLeftButtonUp"
                            MouseMove="ArenaGrid_MouseMove"
                            PreviewMouseLeftButtonDown="ArenaGrid_PreviewMouseLeftButtonDown"
                            PreviewMouseLeftButtonUp="ArenaGrid_PreviewMouseLeftButtonUp"
                            PreviewMouseRightButtonDown="ArenaGrid_PreviewRightMouseButtonDown"
                            SelectedItem="{Binding SelectedObject, Mode=TwoWay}"
                            SelectionChanged="ArenaGrid_SelectionChanged"
                            SelectionMode="Single">
                            <!--    -->
                            <ListBox.Style>
                                <Style TargetType="ListBox">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsPointerVisible}" Value="True">
                                            <Setter Property="Cursor" Value="Pen" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </ListBox.Style>
                            <ListBox.Resources>

                                <!--  Datatemplate BattlegroundCreature (Hero & Enemy)  -->
                                <DataTemplate DataType="{x:Type model:BattlegroundCreature}">
                                    <Thumb DragDelta="Thumb_Drag">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="{x:Type Thumb}">
                                                <Canvas x:Name="canvasCreature">
                                                    <Canvas.ContextMenu>
                                                        <ContextMenu>
                                                            <DockPanel>
                                                                <TextBlock
                                                                    VerticalAlignment="Center"
                                                                    DockPanel.Dock="Left"
                                                                    Text="Position: " />
                                                                <ComboBox
                                                                    DockPanel.Dock="Right"
                                                                    ItemsSource="{StaticResource PositionenValues}"
                                                                    SelectedValue="{Binding Path=Position, Converter={StaticResource PositionenValues}}" />
                                                            </DockPanel>

                                                            <DockPanel>
                                                                <TextBlock
                                                                    VerticalAlignment="Center"
                                                                    DockPanel.Dock="Left"
                                                                    Text="Kampfstil: " />
                                                                <ComboBox
                                                                    DockPanel.Dock="Right"
                                                                    SelectedValue="{Binding Kampfstil}"
                                                                    SelectedValuePath="Stil">
                                                                    <ComboBox.ItemsSource>
                                                                        <kampflogic:KampfstilListe />
                                                                    </ComboBox.ItemsSource>
                                                                    <ComboBox.ItemTemplate>
                                                                        <DataTemplate>
                                                                            <StackPanel Orientation="Horizontal">
                                                                                <Image MaxWidth="24" Source="{Binding Bild}" />
                                                                                <TextBlock
                                                                                    Margin="2,0,0,0"
                                                                                    VerticalAlignment="Center"
                                                                                    Text="{Binding Name}" />
                                                                            </StackPanel>
                                                                        </DataTemplate>
                                                                    </ComboBox.ItemTemplate>
                                                                    <ComboBox.ToolTip>
                                                                        <TextBlock Text="{Binding Kampfstil}" />
                                                                    </ComboBox.ToolTip>
                                                                </ComboBox>
                                                            </DockPanel>

                                                            <MenuItem Command="{Binding ki.Passiv}" Header="Passiv im Kampf">
                                                                <MenuItem.Icon>
                                                                    <Image MaxWidth="24" Source="/DSA%20MeisterGeister;component/Images/Icons/Schild.png" />
                                                                </MenuItem.Icon>
                                                            </MenuItem>

                                                            <MenuItem
                                                                Command="{Binding ki.Unsichtbar}"
                                                                Header="Ist Unsichtbar"
                                                                IsCheckable="True">
                                                                <MenuItem.Icon>
                                                                    <Image MaxWidth="24" Source="/DSA%20MeisterGeister;component/Images/Icons/Meisterperson.png" />
                                                                </MenuItem.Icon>
                                                            </MenuItem>

                                                            <MenuItem
                                                                Command="{Binding ki.Anführer}"
                                                                Header="Ist Anführer"
                                                                IsCheckable="True">
                                                                <MenuItem.Icon>
                                                                    <Image MaxWidth="24" Source="/DSA%20MeisterGeister;component/Images/Icons/Krone.png" />
                                                                </MenuItem.Icon>
                                                            </MenuItem>

                                                            <MenuItem Header="Hat Lichtquelle">
                                                                <MenuItem.Icon>
                                                                    <Image MaxWidth="24" Source="/DSA%20MeisterGeister;component/Images/Icons/Wetter/Sonne.png" />
                                                                </MenuItem.Icon>

                                                                <MenuItem
                                                                    Header="Keine"
                                                                    IsCheckable="True"
                                                                    IsChecked="{Binding ki.LichtquelleMeter, Converter={StaticResource IsIntToBoolConverter1}, ConverterParameter='0'}" />

                                                                <MenuItem IsCheckable="True" IsChecked="{Binding ki.LichtquelleMeter, Converter={StaticResource IsIntToBoolConverter1}, ConverterParameter='1'}">
                                                                    <MenuItem.Header>
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <Image
                                                                                Width="25"
                                                                                MaxHeight="25"
                                                                                Source="/DSA%20MeisterGeister;component/Images/Icons/Kienspan.png" />
                                                                            <TextBlock
                                                                                Margin="5,0,0,0"
                                                                                VerticalAlignment="Center"
                                                                                Text="Kienspäne [1-2m]" />
                                                                        </StackPanel>
                                                                    </MenuItem.Header>
                                                                </MenuItem>
                                                                <MenuItem IsCheckable="True" IsChecked="{Binding ki.LichtquelleMeter, Converter={StaticResource IsIntToBoolConverter1}, ConverterParameter='2'}">
                                                                    <MenuItem.Header>
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <Image
                                                                                Width="25"
                                                                                MaxHeight="25"
                                                                                Source="/DSA%20MeisterGeister;component/Images/Icons/Binsenlicht.png" />
                                                                            <TextBlock
                                                                                Margin="5,0,0,0"
                                                                                VerticalAlignment="Center"
                                                                                Text="Binsenlichter [2-3m]" />
                                                                        </StackPanel>
                                                                    </MenuItem.Header>
                                                                </MenuItem>
                                                                <MenuItem IsCheckable="True" IsChecked="{Binding ki.LichtquelleMeter, Converter={StaticResource IsIntToBoolConverter1}, ConverterParameter='3'}">
                                                                    <MenuItem.Header>
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <Image
                                                                                Width="25"
                                                                                MaxHeight="25"
                                                                                Source="/DSA%20MeisterGeister;component/Images/Icons/Kerze.png" />
                                                                            <TextBlock
                                                                                Margin="5,0,0,0"
                                                                                VerticalAlignment="Center"
                                                                                Text="Kerze [3m]" />
                                                                        </StackPanel>
                                                                    </MenuItem.Header>
                                                                </MenuItem>
                                                                <MenuItem IsCheckable="True" IsChecked="{Binding ki.LichtquelleMeter, Converter={StaticResource IsIntToBoolConverter1}, ConverterParameter='4'}">
                                                                    <MenuItem.Header>
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <Image
                                                                                Width="25"
                                                                                MaxHeight="25"
                                                                                Source="/DSA%20MeisterGeister;component/Images/Icons/Laterne.png" />
                                                                            <TextBlock
                                                                                Margin="5,0,0,0"
                                                                                VerticalAlignment="Center"
                                                                                Text="Laterne [3-4]" />
                                                                        </StackPanel>
                                                                    </MenuItem.Header>
                                                                </MenuItem>
                                                                <MenuItem IsCheckable="True" IsChecked="{Binding ki.LichtquelleMeter, Converter={StaticResource IsIntToBoolConverter1}, ConverterParameter='6'}">
                                                                    <MenuItem.Header>
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <Image
                                                                                Width="25"
                                                                                MaxHeight="25"
                                                                                Source="/DSA%20MeisterGeister;component/Images/Icons/Fackel.png" />
                                                                            <TextBlock
                                                                                Margin="5,0,0,0"
                                                                                VerticalAlignment="Center"
                                                                                Text="Pechfackel [4-6m]" />
                                                                        </StackPanel>
                                                                    </MenuItem.Header>
                                                                </MenuItem>
                                                                <MenuItem IsCheckable="True" IsChecked="{Binding ki.LichtquelleMeter, Converter={StaticResource IsIntToBoolConverter1}, ConverterParameter='7'}">
                                                                    <MenuItem.Header>
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <Image
                                                                                Width="25"
                                                                                MaxHeight="25"
                                                                                Source="/DSA%20MeisterGeister;component/Images/Icons/Laterne.png" />
                                                                            <TextBlock
                                                                                Margin="5,0,0,0"
                                                                                VerticalAlignment="Center"
                                                                                Text="Bend-/Sturmlaterne [2-8m]" />
                                                                        </StackPanel>
                                                                    </MenuItem.Header>
                                                                </MenuItem>
                                                                <MenuItem IsCheckable="True" IsChecked="{Binding ki.LichtquelleMeter, Converter={StaticResource IsIntToBoolConverter1}, ConverterParameter='8'}">
                                                                    <MenuItem.Header>
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <Image
                                                                                Width="25"
                                                                                MaxHeight="25"
                                                                                Source="/DSA%20MeisterGeister;component/Images/Icons/Fackel.png" />
                                                                            <TextBlock
                                                                                Margin="5,0,0,0"
                                                                                VerticalAlignment="Center"
                                                                                Text="Fackel [8m]" />
                                                                        </StackPanel>
                                                                    </MenuItem.Header>
                                                                </MenuItem>
                                                                <MenuItem IsCheckable="True" IsChecked="{Binding ki.LichtquelleMeter, Converter={StaticResource IsIntToBoolConverter1}, ConverterParameter='10'}">
                                                                    <MenuItem.Header>
                                                                        <StackPanel Orientation="Horizontal">
                                                                            <Image
                                                                                Width="25"
                                                                                MaxHeight="25"
                                                                                Source="/DSA%20MeisterGeister;component/Images/Icons/Lagerfeuer.png" />
                                                                            <TextBlock
                                                                                Margin="5,0,0,0"
                                                                                VerticalAlignment="Center"
                                                                                Text="Lagerfeuer [10m]" />
                                                                        </StackPanel>
                                                                    </MenuItem.Header>
                                                                </MenuItem>

                                                                <DockPanel>
                                                                    <TextBlock
                                                                        VerticalAlignment="Center"
                                                                        DockPanel.Dock="Left"
                                                                        Text="Selbst " />
                                                                    <ViewGeneral:IntBox
                                                                        Margin="2,0,0,0"
                                                                        HorizontalContentAlignment="Stretch"
                                                                        DecValue="1"
                                                                        DecWheel="1"
                                                                        DockPanel.Dock="Right"
                                                                        IncValue="1"
                                                                        IncWheel="1"
                                                                        MaxValue="20"
                                                                        MinValue="0"
                                                                        ShowButtons="True"
                                                                        Value="{Binding ki.LichtquelleMeter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                                </DockPanel>
                                                            </MenuItem>

                                                            <MenuItem Command="{Binding ki.Entfernen}" Header="Aus Kampf entfernen">
                                                                <MenuItem.Icon>
                                                                    <Image MaxWidth="24" Source="/DSA%20MeisterGeister;component/Images/Icons/General/entf_01.png" />
                                                                </MenuItem.Icon>
                                                            </MenuItem>
                                                        </ContextMenu>
                                                    </Canvas.ContextMenu>
                                                    <Canvas.Style>
                                                        <Style TargetType="Canvas">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding IsVisible}" Value="False">
                                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                                </DataTrigger>
                                                                <DataTrigger Binding="{Binding IsMoving}" Value="True">
                                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Canvas.Style>
                                                    <Canvas.Effect>
                                                        <DropShadowEffect
                                                            BlurRadius="20"
                                                            ShadowDepth="10"
                                                            Color="{Binding DataContext.Farbmarkierung, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBoxItem}}, UpdateSourceTrigger=PropertyChanged}" />
                                                    </Canvas.Effect>

                                                    <!--  Lichtquelle  -->
                                                    <Ellipse
                                                        Canvas.Left="{Binding ki.LightCreatureX, UpdateSourceTrigger=PropertyChanged}"
                                                        Canvas.Top="{Binding ki.LightCreatureY, UpdateSourceTrigger=PropertyChanged}"
                                                        Width="{Binding ki.LichtquellePixelRadius}"
                                                        Height="{Binding ki.LichtquellePixelRadius}"
                                                        Opacity="0.4"
                                                        Stroke="#FFF0FC00"
                                                        StrokeThickness="2">
                                                        <Ellipse.Fill>
                                                            <RadialGradientBrush>
                                                                <GradientStop Offset="1" Color="Transparent" />
                                                                <GradientStop Offset=".8" Color="#FFF0FC00" />
                                                            </RadialGradientBrush>
                                                        </Ellipse.Fill>
                                                        <Ellipse.Style>
                                                            <Style TargetType="{x:Type Ellipse}">
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding ki.LichtquellePixel}" Value="0">
                                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Ellipse.Style>
                                                    </Ellipse>

                                                    <!--  SightArea  -->
                                                    <Path
                                                        Data="{Binding SightAreaGeometryData}"
                                                        IsHitTestVisible="False"
                                                        Opacity="0.2"
                                                        StrokeThickness="1">
                                                        <Path.Style>
                                                            <Style TargetType="Path">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                                <Setter Property="Fill" Value="Yellow" />
                                                                <Setter Property="Stroke" Value="Yellow" />
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding VM.ShowSightArea, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}, UpdateSourceTrigger=PropertyChanged}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding ki.Kämpfer.IsHeld}" Value="False">
                                                                        <Setter Property="Fill" Value="DarkOrange" />
                                                                        <Setter Property="Stroke" Value="DarkOrange" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Path.Style>
                                                    </Path>

                                                    <!--  Frame for Heroe Picture  -->
                                                    <Rectangle
                                                        Canvas.Left="{Binding CreatureX, UpdateSourceTrigger=PropertyChanged}"
                                                        Canvas.Top="{Binding CreatureY, UpdateSourceTrigger=PropertyChanged}"
                                                        Width="{Binding CreatureWidth, UpdateSourceTrigger=PropertyChanged}"
                                                        Height="{Binding CreatureHeight, UpdateSourceTrigger=PropertyChanged}"
                                                        RadiusX="12"
                                                        RadiusY="12"
                                                        Stroke="#FF5D5757"
                                                        ToolTip="{Binding Name}">
                                                        <Rectangle.Fill>
                                                            <ImageBrush Opacity="{Binding Opacity}" Stretch="Fill">
                                                                <ImageBrush.ImageSource>
                                                                    <Binding
                                                                        Converter="{StaticResource ImagePathConverter}"
                                                                        IsAsync="True"
                                                                        Mode="OneWay"
                                                                        Path="Bild">
                                                                        <Binding.FallbackValue>
                                                                            <ImageSource>
                                                                                /DSA MeisterGeister;component/Images/Icons/General/fragezeichen.png
                                                                            </ImageSource>
                                                                        </Binding.FallbackValue>
                                                                        <Binding.TargetNullValue>
                                                                            <ImageSource>
                                                                                /DSA MeisterGeister;component/Images/Icons/General/fragezeichen.png
                                                                            </ImageSource>
                                                                        </Binding.TargetNullValue>
                                                                    </Binding>
                                                                </ImageBrush.ImageSource>
                                                            </ImageBrush>
                                                        </Rectangle.Fill>
                                                    </Rectangle>

                                                    <!--  -Z-Level  -->
                                                    <TextBlock
                                                        Canvas.Left="{Binding ZDisplayX}"
                                                        Canvas.Top="{Binding ZDisplayY}"
                                                        Width="60"
                                                        FontSize="10"
                                                        FontWeight="Bold"
                                                        IsHitTestVisible="False"
                                                        Text="{Binding ZLevel}"
                                                        TextAlignment="Center"
                                                        Visibility="{Binding DataContext.ShowZ, Converter={StaticResource BoolToVisibilityConverter}, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" />

                                                    <!--  Wunden  -->
                                                    <Image
                                                        Canvas.Left="{Binding ZDisplayX}"
                                                        Canvas.Top="{Binding ZDisplayY}"
                                                        Width="40"
                                                        Height="40"
                                                        Margin="-35,30,0,0"
                                                        Source="/DSA MeisterGeister;component/Images/Icons/Schaden.png">
                                                        <Image.Style>
                                                            <Style TargetType="{x:Type Image}">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Wunden, ConverterParameter=1, Converter={StaticResource IsEqualOrGreaterThanConverter1}}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding WundenByZone[Unlokalisiert], ConverterParameter=1, Converter={StaticResource IsEqualOrGreaterThanConverter1}}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding WundenByZone[Kopf], ConverterParameter=1, Converter={StaticResource IsEqualOrGreaterThanConverter1}}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding WundenByZone[Brust], ConverterParameter=1, Converter={StaticResource IsEqualOrGreaterThanConverter1}}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding WundenByZone[ArmR], ConverterParameter=1, Converter={StaticResource IsEqualOrGreaterThanConverter1}}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding WundenByZone[ArmL], ConverterParameter=1, Converter={StaticResource IsEqualOrGreaterThanConverter1}}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding WundenByZone[Bauch], ConverterParameter=1, Converter={StaticResource IsEqualOrGreaterThanConverter1}}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding WundenByZone[BeinR], ConverterParameter=1, Converter={StaticResource IsEqualOrGreaterThanConverter1}}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding WundenByZone[BeinL], ConverterParameter=1, Converter={StaticResource IsEqualOrGreaterThanConverter1}}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Image.Style>
                                                    </Image>

                                                    <!--  HinweisText  -->
                                                    <TextBlock
                                                        Canvas.Left="{Binding CreatureNameX}"
                                                        Canvas.Top="{Binding CreatureNameY}"
                                                        Width="140"
                                                        Margin="0,-220,0,0"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Bottom"
                                                        Background="White"
                                                        FontSize="14"
                                                        FontStyle="Italic"
                                                        TextAlignment="Center"
                                                        TextWrapping="Wrap">
                                                        <TextBlock.Style>
                                                            <Style TargetType="{x:Type TextBlock}">
                                                                <Setter Property="Text" Value="{Binding HinweisText, UpdateSourceTrigger=PropertyChanged}" />
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding HinweisText}" Value="">
                                                                        <Setter Property="Visibility" Value="Collapsed" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>

                                                    <!--  -CreatureName  -->
                                                    <TextBlock
                                                        Canvas.Left="{Binding CreatureNameX}"
                                                        Canvas.Top="{Binding CreatureNameY}"
                                                        Width="160"
                                                        FontSize="17"
                                                        FontWeight="Normal"
                                                        IsHitTestVisible="False"
                                                        TextAlignment="Center">
                                                        <TextBlock.Style>
                                                            <Style TargetType="{x:Type TextBlock}">
                                                                <Setter Property="Text" Value="{Binding KämpferTempName, FallbackValue=''}" />
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsHeld}" Value="False">
                                                                        <Setter Property="Text" Value="{Binding KämpferTempName}" />
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding IsHeld}" Value="True">
                                                                        <Setter Property="Text" Value="{Binding Kurzname}" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>

                                                    <!--  Lebensbalken  -->
                                                    <ProgressBar
                                                        Canvas.Left="{Binding CreatureX}"
                                                        Canvas.Top="{Binding CreatureY}"
                                                        Width="10"
                                                        Height="{Binding CreatureHeight}"
                                                        Margin="-12,0,0,0"
                                                        HorizontalAlignment="Left"
                                                        VerticalAlignment="Top"
                                                        Background="#FF3DD81A"
                                                        Maximum="{Binding LebensenergieMax}"
                                                        Minimum="0"
                                                        Orientation="Vertical"
                                                        Visibility="{Binding ShowLebensbalken, Converter={StaticResource BooleanToVisibilityConverter1}, UpdateSourceTrigger=PropertyChanged}"
                                                        Value="{Binding LebensenergieAktuell}" />

                                                    <!--  Anführer-Krone  -->
                                                    <Image
                                                        Canvas.Left="{Binding CreatureNameX}"
                                                        Canvas.Top="{Binding CreatureNameY}"
                                                        Width="40"
                                                        Height="40"
                                                        Margin="0,-32,0,0"
                                                        Source="/DSA%20MeisterGeister;component/Images/Icons/Krone.png"
                                                        Visibility="{Binding ki.IstAnführer, UpdateSourceTrigger=PropertyChanged, Converter={StaticResource BooleanToVisibilityConverter1}}" />

                                                    <!--  Position  -->
                                                    <Image
                                                        Canvas.Left="{Binding CreatureNameX}"
                                                        Canvas.Top="{Binding CreatureNameY}"
                                                        Width="50"
                                                        Height="50"
                                                        Source="{Binding Position, Converter={StaticResource PositionToImageConverter1}, UpdateSourceTrigger=PropertyChanged}" />

                                                    <!--  Angriff-Abwehraktionen  -->
                                                    <Grid
                                                        Canvas.Left="{Binding CreatureX, UpdateSourceTrigger=PropertyChanged}"
                                                        Canvas.Top="{Binding CreatureY, UpdateSourceTrigger=PropertyChanged}"
                                                        Margin="{Binding MarginCreatureATPAaktionen}"
                                                        HorizontalAlignment="Left">
                                                        <Slider
                                                            Width="50"
                                                            Margin="-50,0,0,0"
                                                            VerticalAlignment="Bottom"
                                                            IsSnapToTickEnabled="True"
                                                            Maximum="{Binding ki.Aktionen, UpdateSourceTrigger=PropertyChanged}"
                                                            Minimum="0"
                                                            ToolTip="Aktionen umwandeln"
                                                            Value="{Binding ki.Angriffsaktionen, UpdateSourceTrigger=PropertyChanged}" />
                                                        <StackPanel Margin="35,0,-3,0" Orientation="Horizontal">
                                                            <ViewGeneral:ImageDuplicator
                                                                Padding="0"
                                                                VerticalAlignment="Top"
                                                                Anzahl="{Binding ki.VerbrauchteAngriffsaktionen, UpdateSourceTrigger=PropertyChanged}"
                                                                ImageSource="/DSA%20MeisterGeister;component/Images/Icons/nahkampf_01_gestrichen.png" />
                                                            <ViewGeneral:ImageDuplicator
                                                                Padding="0"
                                                                VerticalAlignment="Top"
                                                                Anzahl="{Binding ki.AngriffsaktionenÜbrig, UpdateSourceTrigger=PropertyChanged}"
                                                                ImageSource="/DSA%20MeisterGeister;component/Images/Icons/nahkampf_01.png" />

                                                            <ViewGeneral:ImageDuplicator
                                                                Padding="0"
                                                                VerticalAlignment="Top"
                                                                Anzahl="{Binding ki.VerbrauchteAbwehraktionen, UpdateSourceTrigger=PropertyChanged}"
                                                                ImageSource="/DSA%20MeisterGeister;component/Images/Icons/schild_gestrichen.png" />
                                                            <ViewGeneral:ImageDuplicator
                                                                Padding="0"
                                                                VerticalAlignment="Top"
                                                                Anzahl="{Binding ki.AbwehraktionenÜbrig, UpdateSourceTrigger=PropertyChanged}"
                                                                ImageSource="/DSA%20MeisterGeister;component/Images/Icons/schild.png" />
                                                        </StackPanel>

                                                        <TextBlock
                                                            Width="14"
                                                            Margin="-60,0,0,0"
                                                            HorizontalAlignment="Left"
                                                            VerticalAlignment="Center"
                                                            FontSize="9"
                                                            FontWeight="Bold"
                                                            Text="{Binding ki.AktManöverInfo.Manöver.VerbleibendeDauer, UpdateSourceTrigger=PropertyChanged}" />
                                                    </Grid>

                                                    <!--  Aktionsbuttons rechts  -->
                                                    <Grid
                                                        Canvas.Left="{Binding CreatureX, UpdateSourceTrigger=PropertyChanged}"
                                                        Canvas.Top="{Binding CreatureY, UpdateSourceTrigger=PropertyChanged}"
                                                        Height="{Binding CreatureAktionsbuttonsPos}"
                                                        Margin="{Binding MarginCreatureAktionsbuttons}"
                                                        Background="Transparent">
                                                        <Grid.Style>
                                                            <Style TargetType="Grid">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Grid.Style>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition />
                                                            <RowDefinition />
                                                            <RowDefinition />
                                                            <RowDefinition />
                                                        </Grid.RowDefinitions>

                                                        <MenuItem
                                                            x:Name="miKämpferAttacke"
                                                            Grid.Row="0"
                                                            Width="27"
                                                            Height="27"
                                                            HorizontalAlignment="Center"
                                                            BorderThickness="1"
                                                            Command="{Binding DataContext.OnBtnUmwandelnAttacke, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}"
                                                            CommandParameter="{Binding}">
                                                            <MenuItem.Icon>
                                                                <Image
                                                                    MaxWidth="24"
                                                                    Margin="-1,-3,-3,-3"
                                                                    Source="/DSA%20MeisterGeister;component/Images/Icons/nahkampf_01.png" />
                                                            </MenuItem.Icon>
                                                            <MenuItem.ItemTemplate>
                                                                <DataTemplate>
                                                                    <TextBlock Text="{Binding Name}" />
                                                                </DataTemplate>
                                                            </MenuItem.ItemTemplate>
                                                        </MenuItem>

                                                        <MenuItem
                                                            x:Name="miKämpferFernkampf"
                                                            Grid.Row="1"
                                                            Width="27"
                                                            Height="27"
                                                            HorizontalAlignment="Center"
                                                            BorderThickness="1">
                                                            <MenuItem.Style>
                                                                <Style TargetType="{x:Type MenuItem}">
                                                                    <Setter Property="ItemsSource" Value="{x:Null}" />
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding ki.Kämpfer.Fernkampfwaffen.Count, ConverterParameter=2, Converter={StaticResource IsEqualOrGreaterThanConverter1}}" Value="false">
                                                                            <Setter Property="Command" Value="{Binding DataContext.OnBtnUmwandelnFernkampf, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" />
                                                                        </DataTrigger>
                                                                        <MultiDataTrigger>
                                                                            <MultiDataTrigger.Conditions>
                                                                                <Condition Binding="{Binding ki.Kämpfer.Fernkampfwaffen.Count, ConverterParameter=2, Converter={StaticResource IsEqualOrGreaterThanConverter1}}" Value="true" />
                                                                                <Condition Binding="{Binding IsHeld}" Value="True" />
                                                                            </MultiDataTrigger.Conditions>
                                                                            <Setter Property="ItemsSource" Value="{Binding ki.Kämpfer.Fernkampfwaffen}" />
                                                                        </MultiDataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </MenuItem.Style>
                                                            <MenuItem.Icon>
                                                                <Image
                                                                    MaxWidth="24"
                                                                    Margin="-1,-3,-3,-3"
                                                                    Source="/DSA%20MeisterGeister;component/Images/Icons/fernkampf.png" />
                                                            </MenuItem.Icon>
                                                            <MenuItem.ItemContainerStyle>
                                                                <Style TargetType="{x:Type MenuItem}">
                                                                    <Setter Property="Command" Value="{Binding DataContext.OnBtnUmwandelnFernkampf, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" />
                                                                    <Setter Property="CommandParameter" Value="{Binding}" />
                                                                </Style>
                                                            </MenuItem.ItemContainerStyle>
                                                            <MenuItem.ItemTemplate>
                                                                <DataTemplate>
                                                                    <TextBlock Text="{Binding Name}" />
                                                                </DataTemplate>
                                                            </MenuItem.ItemTemplate>
                                                        </MenuItem>

                                                        <MenuItem
                                                            x:Name="miKämpferZauber"
                                                            Grid.Row="2"
                                                            Width="27"
                                                            Height="27"
                                                            HorizontalAlignment="Center"
                                                            Background="Transparent"
                                                            BorderThickness="1"
                                                            Visibility="{Binding ki.Kämpfer.Magiebegabt, Converter={StaticResource BooleanToVisibilityConverter1}}">
                                                            <MenuItem.Style>
                                                                <Style TargetType="{x:Type MenuItem}">
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding IsHeld}" Value="False">
                                                                            <Setter Property="ItemsSource" Value="{Binding ki.Kämpfer.GegnerBase.GegnerBase_Zauber}" />
                                                                        </DataTrigger>
                                                                        <DataTrigger Binding="{Binding IsHeld}" Value="True">
                                                                            <Setter Property="ItemsSource" Value="{Binding ki.Kämpfer.Held_Zauber}" />
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </MenuItem.Style>
                                                            <MenuItem.Icon>
                                                                <Image
                                                                    MaxWidth="24"
                                                                    Margin="-1,-3,-3,-3"
                                                                    Source="/DSA%20MeisterGeister;component/Images/Icons/magie.png" />
                                                            </MenuItem.Icon>
                                                            <MenuItem.ItemContainerStyle>
                                                                <Style TargetType="{x:Type MenuItem}">
                                                                    <Setter Property="Command" Value="{Binding DataContext.SelManöver.UmwandelnZauber, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" />
                                                                    <Setter Property="CommandParameter" Value="{Binding}" />
                                                                    <Setter Property="Icon" Value="{x:Null}" />
                                                                </Style>
                                                            </MenuItem.ItemContainerStyle>

                                                            <MenuItem.ItemTemplate>
                                                                <DataTemplate>
                                                                    <TextBlock FontSize="{Binding DataContext.FontSize, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" Text="{Binding Zauber.Name}" />
                                                                    <!--</StackPanel>-->
                                                                </DataTemplate>
                                                            </MenuItem.ItemTemplate>
                                                        </MenuItem>

                                                        <MenuItem
                                                            x:Name="miKämpferSonstiges"
                                                            Grid.Row="3"
                                                            Width="27"
                                                            Height="27"
                                                            HorizontalAlignment="Center"
                                                            BorderThickness="1">
                                                            <MenuItem.Icon>
                                                                <Image
                                                                    MaxWidth="24"
                                                                    Margin="-1,-3,-3,-3"
                                                                    Source="/DSA%20MeisterGeister;component/Images/Icons/kalender.png" />
                                                            </MenuItem.Icon>
                                                            <MenuItem.ItemContainerStyle>
                                                                <Style TargetType="{x:Type MenuItem}">
                                                                    <Setter Property="Command" Value="{Binding DataContext.OnBtnUmwandelnSonstiges, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" />
                                                                    <Setter Property="CommandParameter" Value="{Binding}" />
                                                                </Style>
                                                            </MenuItem.ItemContainerStyle>
                                                            <MenuItem.ItemTemplate>
                                                                <DataTemplate>
                                                                    <TextBlock Text="{Binding Name}" />
                                                                </DataTemplate>
                                                            </MenuItem.ItemTemplate>
                                                        </MenuItem>
                                                    </Grid>
                                                </Canvas>

                                                <ControlTemplate.Triggers>
                                                    <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBoxItem}}}" Value="True">
                                                        <Setter Property="Effect">
                                                            <Setter.Value>
                                                                <DropShadowEffect
                                                                    BlurRadius="35"
                                                                    ShadowDepth="10"
                                                                    Color="Yellow" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding IsAnDerReihe}" Value="True">
                                                        <Setter Property="Effect">
                                                            <Setter.Value>
                                                                <DropShadowEffect
                                                                    BlurRadius="35"
                                                                    ShadowDepth="10"
                                                                    Color="#FFC0FCFF" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </DataTemplate>

                                <!--  Datatemplate PATHLINE  -->
                                <DataTemplate DataType="{x:Type model:PathLine}">
                                    <Thumb DragDelta="Thumb_Drag" IsEnabled="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBoxItem}}}">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="{x:Type Thumb}">
                                                <Canvas IsHitTestVisible="{Binding DataContext.IsEditorModeEnabled, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" Visibility="{Binding IsVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <Path
                                                        x:Name="PathLine"
                                                        Data="{Binding PathGeometryData}"
                                                        Opacity="{Binding Opacity}"
                                                        Stroke="{Binding ObjectColor}"
                                                        StrokeThickness="{Binding StrokeThickness}" />
                                                    <TextBlock
                                                        Canvas.Left="{Binding ZDisplayX}"
                                                        Canvas.Top="{Binding ZDisplayY}"
                                                        Width="60"
                                                        FontSize="10"
                                                        FontWeight="Bold"
                                                        IsHitTestVisible="False"
                                                        Text="{Binding ZLevel}"
                                                        TextAlignment="Center"
                                                        Visibility="{Binding DataContext.ShowZ, Converter={StaticResource BoolToVisibilityConverter}, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" />
                                                </Canvas>
                                                <ControlTemplate.Triggers>
                                                    <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBoxItem}}}" Value="True">
                                                        <Setter TargetName="PathLine" Property="Effect">
                                                            <Setter.Value>
                                                                <DropShadowEffect
                                                                    BlurRadius="25"
                                                                    ShadowDepth="10"
                                                                    Color="Yellow" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </DataTemplate>

                                <!--  Datatemplate FILLED PATHLINE  -->
                                <DataTemplate DataType="{x:Type model:FilledPathLine}">
                                    <Thumb DragDelta="Thumb_Drag" IsEnabled="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBoxItem}}}">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="{x:Type Thumb}">
                                                <Canvas IsHitTestVisible="{Binding DataContext.IsEditorModeEnabled, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" Visibility="{Binding IsVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <Path
                                                        x:Name="FilledPathLine"
                                                        Data="{Binding FilledPathGeometryData}"
                                                        Opacity="{Binding Opacity}"
                                                        Stroke="{Binding ObjectColor}"
                                                        StrokeThickness="{Binding StrokeThickness}">
                                                        <Path.Fill>
                                                            <SolidColorBrush Color="{Binding FillColor}" />
                                                        </Path.Fill>
                                                    </Path>
                                                    <TextBlock
                                                        Canvas.Left="{Binding ZDisplayX}"
                                                        Canvas.Top="{Binding ZDisplayY}"
                                                        Width="60"
                                                        FontSize="10"
                                                        FontWeight="Bold"
                                                        IsHitTestVisible="False"
                                                        Text="{Binding ZLevel}"
                                                        TextAlignment="Center"
                                                        Visibility="{Binding DataContext.ShowZ, Converter={StaticResource BoolToVisibilityConverter}, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" />
                                                </Canvas>
                                                <ControlTemplate.Triggers>
                                                    <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBoxItem}}}" Value="True">
                                                        <Setter TargetName="FilledPathLine" Property="Effect">
                                                            <Setter.Value>
                                                                <DropShadowEffect
                                                                    BlurRadius="25"
                                                                    ShadowDepth="10"
                                                                    Color="Yellow" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </DataTemplate>

                                <!--  Datatemplate IMAGEOBJECT  -->
                                <DataTemplate DataType="{x:Type model:ImageObject}">
                                    <Thumb DragDelta="Thumb_Drag" IsEnabled="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBoxItem}}}">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="{x:Type Thumb}">
                                                <Canvas IsHitTestVisible="{Binding DataContext.IsEditorModeEnabled, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" Visibility="{Binding IsVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <Image
                                                        x:Name="ImageObject1"
                                                        Canvas.Left="{Binding ImagePositionX}"
                                                        Canvas.Top="{Binding ImagePositionY}"
                                                        Width="{Binding ImageWidth}"
                                                        Height="{Binding ImageHeight}"
                                                        VerticalAlignment="Top"
                                                        Opacity="{Binding Opacity}"
                                                        RenderTransformOrigin="0.5,0.5"
                                                        Source="{Binding PictureUrl}"
                                                        Stretch="Fill">
                                                        <Image.RenderTransform>
                                                            <RotateTransform Angle="{Binding RotateAngle}" />
                                                        </Image.RenderTransform>
                                                    </Image>
                                                    <TextBlock
                                                        Canvas.Left="{Binding ZDisplayX}"
                                                        Canvas.Top="{Binding ZDisplayY}"
                                                        Width="60"
                                                        FontSize="10"
                                                        FontWeight="Bold"
                                                        IsHitTestVisible="False"
                                                        Text="{Binding ZLevel}"
                                                        TextAlignment="Center"
                                                        Visibility="{Binding DataContext.ShowZ, Converter={StaticResource BoolToVisibilityConverter}, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" />
                                                </Canvas>

                                                <ControlTemplate.Triggers>
                                                    <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBoxItem}}}" Value="True">
                                                        <Setter Property="Effect">
                                                            <Setter.Value>
                                                                <DropShadowEffect
                                                                    BlurRadius="25"
                                                                    ShadowDepth="10"
                                                                    Color="Yellow" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </DataTemplate>

                                <!--  Datatemplate TextLabel Bewegungslänge  -->
                                <DataTemplate DataType="{x:Type model:TextLabel}">
                                    <Thumb DragDelta="Thumb_Drag" IsEnabled="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBoxItem}}}">
                                        <Thumb.Template>
                                            <ControlTemplate TargetType="{x:Type Thumb}">
                                                <Canvas IsHitTestVisible="{Binding DataContext.IsEditorModeEnabled, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" Visibility="{Binding IsVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                                                    <Label
                                                        Canvas.Left="{Binding LabelPositionX}"
                                                        Canvas.Top="{Binding LabelPositionY}"
                                                        Width="{Binding LabelWidth}"
                                                        Height="{Binding LabelHeight}"
                                                        HorizontalAlignment="Center"
                                                        VerticalAlignment="Center"
                                                        HorizontalContentAlignment="Center"
                                                        VerticalContentAlignment="Center"
                                                        Background="Transparent"
                                                        Content="{Binding TextInLabel, UpdateSourceTrigger=PropertyChanged}"
                                                        FontSize="30"
                                                        Foreground="White" />
                                                </Canvas>

                                                <ControlTemplate.Triggers>
                                                    <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type ListBoxItem}}}" Value="True">
                                                        <Setter Property="Effect">
                                                            <Setter.Value>
                                                                <DropShadowEffect
                                                                    BlurRadius="25"
                                                                    ShadowDepth="10"
                                                                    Color="Yellow" />
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Thumb.Template>
                                    </Thumb>
                                </DataTemplate>
                            </ListBox.Resources>

                            <ListBox.Background>
                                <!--  Hexgrid  -->
                                <VisualBrush
                                    TileMode="Tile"
                                    Viewport="{Binding TileViewPort}"
                                    ViewportUnits="Absolute">
                                    <VisualBrush.Visual>
                                        <Path
                                            Data="{Binding TilePathData}"
                                            StrokeDashArray="5 3"
                                            StrokeThickness="3">
                                            <Path.Stroke>
                                                <SolidColorBrush Color="{Binding GridColor, UpdateSourceTrigger=PropertyChanged}" />
                                            </Path.Stroke>
                                        </Path>
                                    </VisualBrush.Visual>
                                </VisualBrush>
                            </ListBox.Background>

                            <ListBox.Template>
                                <ControlTemplate TargetType="{x:Type ListBox}">
                                    <Border Background="{TemplateBinding Background}">
                                        <ItemsPresenter />
                                    </Border>
                                </ControlTemplate>
                            </ListBox.Template>

                            <ListBox.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <Canvas
                                        Background="Transparent"
                                        GiveFeedback="ArenaGrid_GiveFeedback"
                                        IsItemsHost="True" />
                                </ItemsPanelTemplate>
                            </ListBox.ItemsPanel>
                        </ListBox>

                        <s:SpielerPointer Margin="{Binding PointerMargin, UpdateSourceTrigger=PropertyChanged}" />
                    </Grid>
                </wpfxc:ZoomControl>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
